{% extends 'base.html' %}

{% block content %}
<h1>Petpal Dashboard</h1>
<!-- <button type="button" class="button-lg">Pet Pal</button> -->

<h2>My Pets</h2>

<section>
{% if my_pet_list %}
    {% for pet in my_pet_list %}
    <div>
        <div class="pet-display">
            <img class="pet-image-homepage" src="{{pet.profile_Image.url}}">
            <p><a href="{{pet.get_absolute_url}}" class="pet-display-link"><strong>{{ pet.name }}</strong></a>
        </div>
    </div>
    {% endfor %}
{% else %}
    <p>You have no pets.</p>
{% endif %}
    
<div class="pet-display">
<a class="btn btn-primary" href="{% url 'add-pet' %}">Add a Pet</a>
</div>

</section>


<h2>Visits</h2>

<h3>Pets I'm Sitting</h3>

<!-- <section>
    {% if my_checklists %}
        {% for checklist in my_checklists %}
            {{ checklist.pet_id }}
        {% endfor %}
    {% else %}
        <p>You have no upcoming visits.</p>
    {% endif %}  
</section> -->

<section>
    {% if my_visits %}
        {% for visit in my_visits %}
            {% for checklist in all_checklists %}
                {% if checklist.visit == visit %}
                    <p><a href="{{checklist.pet_id.get_absolute_url}}" class="btn btn-primary"><strong>A visit is scheduled for {{ checklist.pet_id }} on {{ checklist.visit.due_date_on }}</strong></a></p>
                {% endif %}
            {% endfor %}
        {% endfor %}
    {% else %}
        <p>You have no upcoming visits.</p>
    {% endif %}  
</section>

<h3>Current Tasks For My Sitters</h3>
    {% for pet in my_pet_list %}

        {% for checklist in all_checklists %}

            {% if checklist.pet_id == pet %}
            <section>
            <p><b>For {{ pet.name }} on {{ checklist.visit.due_date_on }}</b></p>

                {% for task in all_tasks %}
                    {% if task.checklist_id.pet_id == pet and task.checklist_id.visit.due_date_on == checklist.visit.due_date_on  %}
                            {% if task.completed_on %}
                            <span>"{{ task.description }}" completed on {{ task.completed_on }} by {{ checklist.visit.sitter_id }}</span<br>
                            <p></p>
                            {% else %}
                            {{ task.description }}<br>
                            <p></p>
                            {% endif %}
                    {% endif %}
                {% endfor %}
            {% endif %}
        </section>  
        {% endfor %}
    {% endfor %}

{% endblock %} 