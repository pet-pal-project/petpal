{% extends 'base.html' %}

{% block content %}
<h1>Dashboard</h1>
<!-- <button type="button" class="button-lg">Pet Pal</button> -->

<h2>Critters I'm Sitting</h2>

<section>
    {% if my_visits %}
        {% for visit in my_visits %}
            {% for checklist in all_checklists %}
                {% if checklist.visit == visit %}
                <div class="pet-display">
                    <a href="{{checklist.pet_id.get_absolute_url}}" class="btn btn-primary">Scheduled visit for {{ checklist.pet_id }} on {{ checklist.visit.due_date_on }}</a>
                </div>
                {% endif %}
            {% endfor %}
        {% endfor %}
    {% else %}
        <p>You have no upcoming visits.</p>
    {% endif %}  
</section>

<h2>My Critters</h2>
<section>
{% if my_pet_list %}
    {% for pet in my_pet_list %}
    <div>
        <div class="pet-display">
            <img class="pet-image-homepage" src="{{pet.profile_Image.url}}">
            <p><a href="{{pet.get_absolute_url}}" class="pet-display-link"><strong>{{ pet.name }}</strong></a>
        </div>
    </div>
    {% endfor %}
{% else %}
    <p>You have no critters.</p>
{% endif %}
    
<div class="pet-display">
<a class="btn btn-primary" href="{% url 'add-pet' %}">Add a Critter</a>
</div>

</section>



{% if my_pet_list %}
<h2>Tasks For My Sitters</h2>
<section>
    {% for pet in my_pet_list %}

        {% for checklist in all_checklists %}

            {% if checklist.pet_id == pet %}
            <section>
            <p><b>For {{ pet.name }} on {{ checklist.visit.due_date_on }} with pet sitter {{ checklist.visit.sitter_id }}</b></p>

                {% for task in all_tasks %}
                    {% if task.checklist_id.pet_id == pet and task.checklist_id.visit.due_date_on == checklist.visit.due_date_on and task.checklist_id.visit.sitter_id == checklist.visit.sitter_id  %}
                            {% if task.completed_on %}
                            <span>âœ” "{{ task.description }}" completed on {{ task.completed_on }} by {{ checklist.visit.sitter_id }}</span<br>
                            <p></p>
                            {% else %}
                            {{ task.description }}<br>
                            <p></p>
                            {% endif %}
                    {% endif %}
                {% endfor %}
            {% endif %}
        </section>  
        {% endfor %}
    {% endfor %}
</section>
{% endif %}
{% endblock %} 